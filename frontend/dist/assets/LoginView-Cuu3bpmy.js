import{a as d}from"./axios-B6xwUs71.js";import{P as _}from"./PasswordErrorBanner-BGHKtDgi.js";import{_ as f,s as w,r as b,h as k,j as v,k as x,l as L,m as T,n as c,c as U,a as o,w as a,e as u,q as p,t as V,d as m,u as C,f as E,o as y}from"./index-C6X_6u4j.js";const q={components:{PasswordErrorBanner:_},data(){return{consenso:!1,passwordError:!1,credentials:{username:"",password:"",latitude:null,longitude:null}}},methods:{submitForm(){this.consenso?this.login():alert("Devi acconsentire al trattamento dei dati per procedere.")},async login(){const s={username:this.credentials.username,password:this.credentials.password};d.post("http://localhost:3000/api/v1/tokens",s).then(e=>{console.log("Login successful:",e.data),this.passwordError=!1;const l=this.$route.query.nextUrl||"/";this.$router.push({path:l}),w(e.data.token),setTimeout(()=>{b(),alert("Token expired. Please login again."),this.$router.push("/login")},1e6),console.log("VOL: ",k(e.data.token)),console.log("118_Op: ",v(e.data.token)),console.log("CERT: ",x(e.data.token)),d.patch(`http://localhost:3000/api/v1/users/${L(T()).userId}`,{latitude:this.credentials.latitude,longitude:this.credentials.longitude},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(n=>{console.log("Location updated:",n.data)},n=>{console.error("Location update failed:",n.response.data)}).catch(n=>{console.error("Axios request failed:",n)})},e=>{this.passwordError=!0,console.error("Login failed:",e.response.data),localStorage.removeItem("token")}).catch(e=>{console.error("Axios request failed:",e)})},getUserLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(s=>{this.credentials.latitude=Number(s.coords.latitude),this.credentials.longitude=Number(s.coords.longitude)},s=>{console.error("Error Code = "+s.code+" - "+s.message)}):console.log("Geolocation is not supported by this browser.")}},created(){this.getUserLocation()}},P={class:"login-container"},B=o("h2",null,"Login",-1),N={class:"input-group"},A=o("label",{for:"username"},"Username",-1),F={class:"input-group"},I=o("label",{for:"password"},"Password",-1),M=o("br",null,null,-1),O=o("br",null,null,-1),R=o("br",null,null,-1),S=o("br",null,null,-1),D=o("button",{type:"submit"},"Login",-1);function j(s,e,l,n,t,i){const h=c("password-error-banner"),g=c("RouterLink");return y(),U("div",P,[o("form",{onSubmit:e[3]||(e[3]=E((...r)=>i.submitForm&&i.submitForm(...r),["prevent"])),class:"login-form"},[B,o("div",N,[A,a(o("input",{type:"text",id:"username","onUpdate:modelValue":e[0]||(e[0]=r=>t.credentials.username=r),required:""},null,512),[[u,t.credentials.username]])]),o("div",F,[I,a(o("input",{type:"password",id:"password","onUpdate:modelValue":e[1]||(e[1]=r=>t.credentials.password=r),required:""},null,512),[[u,t.credentials.password]]),p(h,{show:t.passwordError},null,8,["show"])]),M,O,o("label",null,[a(o("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=r=>t.consenso=r)},null,512),[[V,t.consenso]]),m(" Acconsento al trattamento dei miei dati personali secondo la normativa vigente. ")]),R,S,D,p(g,{to:"/forgotPassword",class:"forgot-password-link"},{default:C(()=>[m("Forgot password?")]),_:1})],32)])}const J=f(q,[["render",j]]);export{J as default};
