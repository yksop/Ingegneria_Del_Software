import{a as p}from"./axios-B6xwUs71.js";import{_ as m,l as _,m as g,n as v,c as a,y as o,z as c,a as e,F as w,C as A,q as b,u as P,o as i,d as l}from"./index-C6X_6u4j.js";const k={data(){return{alerts:[],users:{_id:""},showPopup:!1,selectedAlert:null,errorMessage:null,showPreviewButton:[],acceptedAlertIndex:null,bestPracticeDescription:"",read:!1}},created(){this.showPreviewButton=this.alerts.map(()=>!1),p.get(`http://localhost:3000/api/v1/users/${_(g()).userId}/alerts`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(t=>{this.alerts=t.data,this.users._id=t.data}).catch(t=>{t.response?this.errorMessage=t.response.data:this.errorMessage="Error fetching data"})},methods:{agreeToAlert(t){this.errorMessage="",this.showPreviewButton=this.showPreviewButton.map(()=>!1),this.showPreviewButton[t]=!0,this.acceptedAlertIndex=t,this.read=!1,this.bestPracticeDescription="",p.patch(`http://localhost:3000/api/v1/users/${_(g()).userId}`,{alertId:this.alerts[this.acceptedAlertIndex]._id},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(s=>{this.selectedAlert=this.alerts[t],this.alerts[t].accepted=!0,this.alerts[t].emergency===void 0?this.bestPracticeDescription="No best practices found for this emergency":this.getBestPractices(this.alerts[t].emergency)}).catch(s=>{s.response?this.errorMessage=s.response.data:this.errorMessage="Error agreeing to alert"})},getBestPractices(t){p.get(`http://localhost:3000/api/v1/bestpractises?title=${t}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(s=>{this.bestPracticeDescription=s.data.advise}).catch(s=>{s.response?this.errorMessage=s.response.data:this.errorMessage="Error fetching best practices"})},readBestPractices(){this.read=!0},showPreviewAlert(t){p.get(`http://localhost:3000/api/v1/alerts/${this.alerts[t]._id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(s=>{this.showPopup=!0}).catch(s=>{s.response?this.errorMessage=s.response.data:this.errorMessage="Error showing alert preview"})}}},B={key:0,class:"error-message"},M={class:"alert-container"},y={class:"alert-frame"},I=e("span",{class:"alert-info"},"Alert ID:",-1),C=e("span",{class:"alert-info"},"Latitude:",-1),T=e("span",{class:"alert-info"},"Longitude:",-1),D=e("span",{class:"alert-info"},"Description:",-1),E=["onClick","disabled"],V=["onClick"],z={key:1,class:"popup"},L=e("h2",null,"Preview",-1),N={key:0},S=e("span",{class:"alert-info"},"Triage:",-1),F=e("br",null,null,-1),H=e("span",{class:"alert-info"},"Time for Ambulance:",-1),q=e("br",null,null,-1),x=e("span",{class:"alert-info"},"Description:",-1),G=e("br",null,null,-1),R=e("span",{class:"alert-info"},"Emergency:",-1),j=e("br",null,null,-1),J=["innerHTML"],K=e("button",{class:"logged-button"},"Go back",-1);function O(t,s,Q,U,r,h){const f=v("router-link");return i(),a("div",null,[r.errorMessage?(i(),a("div",B,o(r.errorMessage),1)):c("",!0),e("div",M,[e("div",y,[e("ol",null,[(i(!0),a(w,null,A(r.alerts,(d,n)=>(i(),a("li",{key:n},[I,l(" "+o(d._id)+" | ",1),C,l(" "+o(d.latitude)+" | ",1),T,l(" "+o(d.longitude)+" | ",1),D,l(" "+o(d.description)+" ",1),e("button",{class:"button",onClick:u=>h.agreeToAlert(n),disabled:r.acceptedAlertIndex===n}," Accept ",8,E),r.showPreviewButton[n]?(i(),a("button",{key:0,class:"button",onClick:u=>h.showPreviewAlert(n)}," Preview Alert ",8,V)):c("",!0),r.showPopup?(i(),a("div",z,[L,r.selectedAlert?(i(),a("p",N)):c("",!0),S,l(" "+o(r.selectedAlert.triage)+" ",1),F,H,l(" "+o(r.selectedAlert.timeForAmbulance)+" ",1),q,x,l(" "+o(r.selectedAlert.description),1),G,R,l(" "+o(r.selectedAlert.emergency),1),j,e("button",{onClick:s[0]||(s[0]=(...u)=>h.readBestPractices&&h.readBestPractices(...u))},"Read Best Practices"),r.read?(i(),a("div",{key:1,innerHTML:r.bestPracticeDescription},null,8,J)):c("",!0),e("button",{onClick:s[1]||(s[1]=u=>r.showPopup=!1)},"Close")])):c("",!0)]))),128))])]),b(f,{to:"/actionVol"},{default:P(()=>[K]),_:1})])])}const Y=m(k,[["render",O]]);export{Y as default};
